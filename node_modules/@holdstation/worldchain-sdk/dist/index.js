'use strict';var asyncMutex=require('async-mutex'),k=require('bignumber.js'),idb=require('idb'),minikitJs=require('@worldcoin/minikit-js');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var k__default=/*#__PURE__*/_interopDefault(k);var re=Object.defineProperty;var se=(o,e)=>{for(var t in e)re(o,t,{get:e[t],enumerable:true});};var B={};se(B,{DEX_ABI:()=>q,ERC20_ABI:()=>g,MULTICALL3_JSONABI:()=>oe,uniswapQuoterV2ABI:()=>pe,uniswapRouterV2ABI:()=>ue,uniswapRouterV3ABI:()=>le,viewQuoterv3ABI:()=>ye});var q=[{type:"receive",stateMutability:"payable"},{type:"function",name:"feeReceiver",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"fillQuoteEthToToken",inputs:[{name:"buyTokenAddress",type:"address",internalType:"address"},{name:"target",type:"address",internalType:"address payable"},{name:"swapCallData",type:"bytes",internalType:"bytes"},{name:"partnerData",type:"uint256",internalType:"uint256"},{name:"partnerFeeReceiver",type:"address",internalType:"address"}],outputs:[],stateMutability:"payable"},{type:"function",name:"fillQuoteTokenToEth",inputs:[{name:"sellTokenAddress",type:"address",internalType:"address"},{name:"target",type:"address",internalType:"address payable"},{name:"swapCallData",type:"bytes",internalType:"bytes"},{name:"sellAmount",type:"uint256",internalType:"uint256"},{name:"feePercentage",type:"uint256",internalType:"uint256"},{name:"partnerFeeReceiver",type:"address",internalType:"address"},{name:"permit",type:"tuple",internalType:"struct Permit2",components:[{name:"nonce",type:"uint256",internalType:"uint256"},{name:"deadline",type:"uint256",internalType:"uint256"},{name:"signature",type:"bytes",internalType:"bytes"}]}],outputs:[],stateMutability:"payable"},{type:"function",name:"fillQuoteTokenToToken",inputs:[{name:"sellTokenAddress",type:"address",internalType:"address"},{name:"buyTokenAddress",type:"address",internalType:"address"},{name:"target",type:"address",internalType:"address payable"},{name:"swapCallData",type:"bytes",internalType:"bytes"},{name:"sellAmount",type:"uint256",internalType:"uint256"},{name:"feeToken",type:"uint8",internalType:"enum FeeToken"},{name:"partnerData",type:"uint256",internalType:"uint256"},{name:"partnerFeeReceiver",type:"address",internalType:"address"},{name:"permit",type:"tuple",internalType:"struct Permit2",components:[{name:"nonce",type:"uint256",internalType:"uint256"},{name:"deadline",type:"uint256",internalType:"uint256"},{name:"signature",type:"bytes",internalType:"bytes"}]}],outputs:[],stateMutability:"payable"},{type:"function",name:"initialize",inputs:[{name:"_owner",type:"address",internalType:"address"},{name:"_swapTargets",type:"address[]",internalType:"address[]"},{name:"_permit2",type:"address",internalType:"contract ISignatureTransfer"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"owner",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"permit2",inputs:[],outputs:[{name:"",type:"address",internalType:"contract ISignatureTransfer"}],stateMutability:"view"},{type:"function",name:"renounceOwnership",inputs:[],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"send",inputs:[{name:"recipient",type:"address",internalType:"address payable"}],outputs:[],stateMutability:"payable"},{type:"function",name:"swapTargets",inputs:[{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"transfer",inputs:[{name:"permitTransferFrom",type:"tuple",internalType:"struct ISignatureTransfer.PermitTransferFrom",components:[{name:"permitted",type:"tuple",internalType:"struct ISignatureTransfer.TokenPermissions",components:[{name:"token",type:"address",internalType:"address"},{name:"amount",type:"uint256",internalType:"uint256"}]},{name:"nonce",type:"uint256",internalType:"uint256"},{name:"deadline",type:"uint256",internalType:"uint256"}]},{name:"transferDetails",type:"tuple",internalType:"struct ISignatureTransfer.SignatureTransferDetails",components:[{name:"to",type:"address",internalType:"address"},{name:"requestedAmount",type:"uint256",internalType:"uint256"}]},{name:"receiver",type:"address",internalType:"address"},{name:"signature",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"transferOwnership",inputs:[{name:"newOwner",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"updateFeeRecipient",inputs:[{name:"feeRecipient",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"updateSwapTargets",inputs:[{name:"target",type:"address",internalType:"address"},{name:"add",type:"bool",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"whitelistFeeReceiver",inputs:[{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"withdrawEth",inputs:[{name:"to",type:"address",internalType:"address"},{name:"amount",type:"uint256",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"withdrawToken",inputs:[{name:"token",type:"address",internalType:"address"},{name:"to",type:"address",internalType:"address"},{name:"amount",type:"uint256",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"event",name:"EthWithdrawn",inputs:[{name:"target",type:"address",indexed:true,internalType:"address"},{name:"amount",type:"uint256",indexed:false,internalType:"uint256"}],anonymous:false},{type:"event",name:"FeeDistributed",inputs:[{name:"token",type:"address",indexed:true,internalType:"address"},{name:"recipient",type:"address",indexed:true,internalType:"address"},{name:"amount",type:"uint256",indexed:false,internalType:"uint256"}],anonymous:false},{type:"event",name:"FillQuoteEthToToken",inputs:[{name:"buyToken",type:"address",indexed:true,internalType:"address"},{name:"user",type:"address",indexed:true,internalType:"address"},{name:"target",type:"address",indexed:false,internalType:"address"},{name:"amountSold",type:"uint256",indexed:false,internalType:"uint256"},{name:"amountBought",type:"uint256",indexed:false,internalType:"uint256"},{name:"partnerData",type:"uint256",indexed:false,internalType:"uint256"}],anonymous:false},{type:"event",name:"FillQuoteTokenToEth",inputs:[{name:"sellToken",type:"address",indexed:true,internalType:"address"},{name:"user",type:"address",indexed:true,internalType:"address"},{name:"target",type:"address",indexed:false,internalType:"address"},{name:"amountSold",type:"uint256",indexed:false,internalType:"uint256"},{name:"amountBought",type:"uint256",indexed:false,internalType:"uint256"},{name:"partnerData",type:"uint256",indexed:false,internalType:"uint256"}],anonymous:false},{type:"event",name:"FillQuoteTokenToToken",inputs:[{name:"sellToken",type:"address",indexed:true,internalType:"address"},{name:"buyToken",type:"address",indexed:true,internalType:"address"},{name:"user",type:"address",indexed:true,internalType:"address"},{name:"target",type:"address",indexed:false,internalType:"address"},{name:"amountSold",type:"uint256",indexed:false,internalType:"uint256"},{name:"amountBought",type:"uint256",indexed:false,internalType:"uint256"},{name:"feeToken",type:"uint8",indexed:false,internalType:"enum FeeToken"},{name:"partnerData",type:"uint256",indexed:false,internalType:"uint256"}],anonymous:false},{type:"event",name:"Initialized",inputs:[{name:"version",type:"uint64",indexed:false,internalType:"uint64"}],anonymous:false},{type:"event",name:"OwnershipTransferred",inputs:[{name:"previousOwner",type:"address",indexed:true,internalType:"address"},{name:"newOwner",type:"address",indexed:true,internalType:"address"}],anonymous:false},{type:"event",name:"Sent",inputs:[{name:"sender",type:"address",indexed:true,internalType:"address"},{name:"amount",type:"uint256",indexed:false,internalType:"uint256"},{name:"recipient",type:"address",indexed:true,internalType:"address"}],anonymous:false},{type:"event",name:"SwapTargetAdded",inputs:[{name:"target",type:"address",indexed:true,internalType:"address"}],anonymous:false},{type:"event",name:"SwapTargetRemoved",inputs:[{name:"target",type:"address",indexed:true,internalType:"address"}],anonymous:false},{type:"event",name:"TokenSent",inputs:[{name:"receiver",type:"address",indexed:true,internalType:"address"},{name:"sender",type:"address",indexed:true,internalType:"address"},{name:"token",type:"address",indexed:true,internalType:"address"},{name:"amount",type:"uint256",indexed:false,internalType:"uint256"}],anonymous:false},{type:"event",name:"TokenWithdrawn",inputs:[{name:"token",type:"address",indexed:true,internalType:"address"},{name:"target",type:"address",indexed:true,internalType:"address"},{name:"amount",type:"uint256",indexed:false,internalType:"uint256"}],anonymous:false},{type:"error",name:"InvalidInitialization",inputs:[]},{type:"error",name:"InvalidReceiver",inputs:[]},{type:"error",name:"InvalidToAddress",inputs:[]},{type:"error",name:"NotInitializing",inputs:[]},{type:"error",name:"OwnableInvalidOwner",inputs:[{name:"owner",type:"address",internalType:"address"}]},{type:"error",name:"OwnableUnauthorizedAccount",inputs:[{name:"account",type:"address",internalType:"address"}]},{type:"error",name:"ReentrancyGuardReentrantCall",inputs:[]}];var g=[{constant:true,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:false,stateMutability:"view",type:"function"},{constant:false,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:false,stateMutability:"nonpayable",type:"function"},{constant:true,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{constant:false,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:false,stateMutability:"nonpayable",type:"function"},{constant:true,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:false,stateMutability:"view",type:"function"},{constant:true,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{constant:true,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:false,stateMutability:"view",type:"function"},{constant:false,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:false,stateMutability:"nonpayable",type:"function"},{constant:true,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{payable:true,stateMutability:"payable",type:"fallback"},{anonymous:false,inputs:[{indexed:true,name:"owner",type:"address"},{indexed:true,name:"spender",type:"address"},{indexed:false,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:false,inputs:[{indexed:true,name:"from",type:"address"},{indexed:true,name:"to",type:"address"},{indexed:false,name:"value",type:"uint256"}],name:"Transfer",type:"event"}];var oe=[{inputs:[{components:[{internalType:"address",name:"target",type:"address"},{internalType:"bytes",name:"callData",type:"bytes"}],internalType:"struct Multicall3.Call[]",name:"calls",type:"tuple[]"}],name:"aggregate",outputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"},{internalType:"bytes[]",name:"returnData",type:"bytes[]"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"target",type:"address"},{internalType:"bool",name:"allowFailure",type:"bool"},{internalType:"bytes",name:"callData",type:"bytes"}],internalType:"struct Multicall3.Call3[]",name:"calls",type:"tuple[]"}],name:"aggregate3",outputs:[{components:[{internalType:"bool",name:"success",type:"bool"},{internalType:"bytes",name:"returnData",type:"bytes"}],internalType:"struct Multicall3.Result[]",name:"returnData",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"target",type:"address"},{internalType:"bool",name:"allowFailure",type:"bool"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"callData",type:"bytes"}],internalType:"struct Multicall3.Call3Value[]",name:"calls",type:"tuple[]"}],name:"aggregate3Value",outputs:[{components:[{internalType:"bool",name:"success",type:"bool"},{internalType:"bytes",name:"returnData",type:"bytes"}],internalType:"struct Multicall3.Result[]",name:"returnData",type:"tuple[]"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"address",name:"target",type:"address"},{internalType:"bytes",name:"callData",type:"bytes"}],internalType:"struct Multicall3.Call[]",name:"calls",type:"tuple[]"}],name:"blockAndAggregate",outputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"},{internalType:"bytes32",name:"blockHash",type:"bytes32"},{components:[{internalType:"bool",name:"success",type:"bool"},{internalType:"bytes",name:"returnData",type:"bytes"}],internalType:"struct Multicall3.Result[]",name:"returnData",type:"tuple[]"}],stateMutability:"payable",type:"function"},{inputs:[],name:"getBasefee",outputs:[{internalType:"uint256",name:"basefee",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"}],name:"getBlockHash",outputs:[{internalType:"bytes32",name:"blockHash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"getBlockNumber",outputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getChainId",outputs:[{internalType:"uint256",name:"chainid",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentBlockCoinbase",outputs:[{internalType:"address",name:"coinbase",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentBlockDifficulty",outputs:[{internalType:"uint256",name:"difficulty",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentBlockGasLimit",outputs:[{internalType:"uint256",name:"gaslimit",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentBlockTimestamp",outputs:[{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"}],name:"getEthBalance",outputs:[{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getLastBlockHash",outputs:[{internalType:"bytes32",name:"blockHash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bool",name:"requireSuccess",type:"bool"},{components:[{internalType:"address",name:"target",type:"address"},{internalType:"bytes",name:"callData",type:"bytes"}],internalType:"struct Multicall3.Call[]",name:"calls",type:"tuple[]"}],name:"tryAggregate",outputs:[{components:[{internalType:"bool",name:"success",type:"bool"},{internalType:"bytes",name:"returnData",type:"bytes"}],internalType:"struct Multicall3.Result[]",name:"returnData",type:"tuple[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bool",name:"requireSuccess",type:"bool"},{components:[{internalType:"address",name:"target",type:"address"},{internalType:"bytes",name:"callData",type:"bytes"}],internalType:"struct Multicall3.Call[]",name:"calls",type:"tuple[]"}],name:"tryBlockAndAggregate",outputs:[{internalType:"uint256",name:"blockNumber",type:"uint256"},{internalType:"bytes32",name:"blockHash",type:"bytes32"},{components:[{internalType:"bool",name:"success",type:"bool"},{internalType:"bytes",name:"returnData",type:"bytes"}],internalType:"struct Multicall3.Result[]",name:"returnData",type:"tuple[]"}],stateMutability:"payable",type:"function"}];var pe=[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_WETH9",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"WETH9",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"uint256",name:"amountIn",type:"uint256"}],name:"quoteExactInput",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint160[]",name:"sqrtPriceX96AfterList",type:"uint160[]"},{internalType:"uint32[]",name:"initializedTicksCrossedList",type:"uint32[]"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoterV2.QuoteExactInputSingleParams",name:"params",type:"tuple"}],name:"quoteExactInputSingle",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"uint256",name:"amountOut",type:"uint256"}],name:"quoteExactOutput",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint160[]",name:"sqrtPriceX96AfterList",type:"uint160[]"},{internalType:"uint32[]",name:"initializedTicksCrossedList",type:"uint32[]"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoterV2.QuoteExactOutputSingleParams",name:"params",type:"tuple"}],name:"quoteExactOutputSingle",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"int256",name:"amount0Delta",type:"int256"},{internalType:"int256",name:"amount1Delta",type:"int256"},{internalType:"bytes",name:"path",type:"bytes"}],name:"uniswapV3SwapCallback",outputs:[],stateMutability:"view",type:"function"}];var ue=[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_WETH",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"WETH",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"tokenA",type:"address"},{internalType:"address",name:"tokenB",type:"address"},{internalType:"uint256",name:"amountADesired",type:"uint256"},{internalType:"uint256",name:"amountBDesired",type:"uint256"},{internalType:"uint256",name:"amountAMin",type:"uint256"},{internalType:"uint256",name:"amountBMin",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"addLiquidity",outputs:[{internalType:"uint256",name:"amountA",type:"uint256"},{internalType:"uint256",name:"amountB",type:"uint256"},{internalType:"uint256",name:"liquidity",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountTokenDesired",type:"uint256"},{internalType:"uint256",name:"amountTokenMin",type:"uint256"},{internalType:"uint256",name:"amountETHMin",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"addLiquidityETH",outputs:[{internalType:"uint256",name:"amountToken",type:"uint256"},{internalType:"uint256",name:"amountETH",type:"uint256"},{internalType:"uint256",name:"liquidity",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"reserveIn",type:"uint256"},{internalType:"uint256",name:"reserveOut",type:"uint256"}],name:"getAmountIn",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"reserveIn",type:"uint256"},{internalType:"uint256",name:"reserveOut",type:"uint256"}],name:"getAmountOut",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"}],name:"getAmountsIn",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"}],name:"getAmountsOut",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amountA",type:"uint256"},{internalType:"uint256",name:"reserveA",type:"uint256"},{internalType:"uint256",name:"reserveB",type:"uint256"}],name:"quote",outputs:[{internalType:"uint256",name:"amountB",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"tokenA",type:"address"},{internalType:"address",name:"tokenB",type:"address"},{internalType:"uint256",name:"liquidity",type:"uint256"},{internalType:"uint256",name:"amountAMin",type:"uint256"},{internalType:"uint256",name:"amountBMin",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"removeLiquidity",outputs:[{internalType:"uint256",name:"amountA",type:"uint256"},{internalType:"uint256",name:"amountB",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"liquidity",type:"uint256"},{internalType:"uint256",name:"amountTokenMin",type:"uint256"},{internalType:"uint256",name:"amountETHMin",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"removeLiquidityETH",outputs:[{internalType:"uint256",name:"amountToken",type:"uint256"},{internalType:"uint256",name:"amountETH",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"liquidity",type:"uint256"},{internalType:"uint256",name:"amountTokenMin",type:"uint256"},{internalType:"uint256",name:"amountETHMin",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"removeLiquidityETHSupportingFeeOnTransferTokens",outputs:[{internalType:"uint256",name:"amountETH",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"liquidity",type:"uint256"},{internalType:"uint256",name:"amountTokenMin",type:"uint256"},{internalType:"uint256",name:"amountETHMin",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bool",name:"approveMax",type:"bool"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"removeLiquidityETHWithPermit",outputs:[{internalType:"uint256",name:"amountToken",type:"uint256"},{internalType:"uint256",name:"amountETH",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"liquidity",type:"uint256"},{internalType:"uint256",name:"amountTokenMin",type:"uint256"},{internalType:"uint256",name:"amountETHMin",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bool",name:"approveMax",type:"bool"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"removeLiquidityETHWithPermitSupportingFeeOnTransferTokens",outputs:[{internalType:"uint256",name:"amountETH",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenA",type:"address"},{internalType:"address",name:"tokenB",type:"address"},{internalType:"uint256",name:"liquidity",type:"uint256"},{internalType:"uint256",name:"amountAMin",type:"uint256"},{internalType:"uint256",name:"amountBMin",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bool",name:"approveMax",type:"bool"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"removeLiquidityWithPermit",outputs:[{internalType:"uint256",name:"amountA",type:"uint256"},{internalType:"uint256",name:"amountB",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapETHForExactTokens",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapExactETHForTokens",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapExactETHForTokensSupportingFeeOnTransferTokens",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapExactTokensForETH",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapExactTokensForETHSupportingFeeOnTransferTokens",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapExactTokensForTokens",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapExactTokensForTokensSupportingFeeOnTransferTokens",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMax",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapTokensForExactETH",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMax",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"deadline",type:"uint256"}],name:"swapTokensForExactTokens",outputs:[{internalType:"uint256[]",name:"amounts",type:"uint256[]"}],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}];var le=[{inputs:[{internalType:"address",name:"_factoryV2",type:"address"},{internalType:"address",name:"factoryV3",type:"address"},{internalType:"address",name:"_positionManager",type:"address"},{internalType:"address",name:"_WETH9",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"WETH9",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveMax",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveMaxMinusOne",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveZeroThenMax",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"approveZeroThenMaxMinusOne",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"data",type:"bytes"}],name:"callPositionManager",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes[]",name:"paths",type:"bytes[]"},{internalType:"uint128[]",name:"amounts",type:"uint128[]"},{internalType:"uint24",name:"maximumTickDivergence",type:"uint24"},{internalType:"uint32",name:"secondsAgo",type:"uint32"}],name:"checkOracleSlippage",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"uint24",name:"maximumTickDivergence",type:"uint24"},{internalType:"uint32",name:"secondsAgo",type:"uint32"}],name:"checkOracleSlippage",outputs:[],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMinimum",type:"uint256"}],internalType:"struct IV3SwapRouter.ExactInputParams",name:"params",type:"tuple"}],name:"exactInput",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMinimum",type:"uint256"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IV3SwapRouter.ExactInputSingleParams",name:"params",type:"tuple"}],name:"exactInputSingle",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMaximum",type:"uint256"}],internalType:"struct IV3SwapRouter.ExactOutputParams",name:"params",type:"tuple"}],name:"exactOutput",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMaximum",type:"uint256"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IV3SwapRouter.ExactOutputSingleParams",name:"params",type:"tuple"}],name:"exactOutputSingle",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"factoryV2",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"getApprovalType",outputs:[{internalType:"enum IApproveAndCall.ApprovalType",name:"",type:"uint8"}],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"address",name:"token0",type:"address"},{internalType:"address",name:"token1",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"uint256",name:"amount0Min",type:"uint256"},{internalType:"uint256",name:"amount1Min",type:"uint256"}],internalType:"struct IApproveAndCall.IncreaseLiquidityParams",name:"params",type:"tuple"}],name:"increaseLiquidity",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"address",name:"token0",type:"address"},{internalType:"address",name:"token1",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"int24",name:"tickLower",type:"int24"},{internalType:"int24",name:"tickUpper",type:"int24"},{internalType:"uint256",name:"amount0Min",type:"uint256"},{internalType:"uint256",name:"amount1Min",type:"uint256"},{internalType:"address",name:"recipient",type:"address"}],internalType:"struct IApproveAndCall.MintParams",name:"params",type:"tuple"}],name:"mint",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"previousBlockhash",type:"bytes32"},{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes[]",name:"data",type:"bytes[]"}],name:"multicall",outputs:[{internalType:"bytes[]",name:"results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[],name:"positionManager",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"pull",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"refundETH",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"selfPermit",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"nonce",type:"uint256"},{internalType:"uint256",name:"expiry",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"selfPermitAllowed",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"nonce",type:"uint256"},{internalType:"uint256",name:"expiry",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"selfPermitAllowedIfNecessary",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"selfPermitIfNecessary",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint256",name:"amountOutMin",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"}],name:"swapExactTokensForTokens",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint256",name:"amountInMax",type:"uint256"},{internalType:"address[]",name:"path",type:"address[]"},{internalType:"address",name:"to",type:"address"}],name:"swapTokensForExactTokens",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"}],name:"sweepToken",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"}],name:"sweepToken",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"sweepTokenWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"sweepTokenWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"int256",name:"amount0Delta",type:"int256"},{internalType:"int256",name:"amount1Delta",type:"int256"},{internalType:"bytes",name:"_data",type:"bytes"}],name:"uniswapV3SwapCallback",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"}],name:"unwrapWETH9",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"unwrapWETH9WithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountMinimum",type:"uint256"},{internalType:"uint256",name:"feeBips",type:"uint256"},{internalType:"address",name:"feeRecipient",type:"address"}],name:"unwrapWETH9WithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"value",type:"uint256"}],name:"wrapETH",outputs:[],stateMutability:"payable",type:"function"},{stateMutability:"payable",type:"receive"}];var ye=[{inputs:[{internalType:"address",name:"_factory",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"uint256",name:"amountIn",type:"uint256"}],name:"quoteExactInput",outputs:[{internalType:"uint256",name:"amountOut",type:"uint256"},{internalType:"uint160[]",name:"sqrtPriceX96AfterList",type:"uint160[]"},{internalType:"uint32[]",name:"initializedTicksCrossedList",type:"uint32[]"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoter.QuoteExactInputSingleParams",name:"params",type:"tuple"}],name:"quoteExactInputSingle",outputs:[{internalType:"uint256",name:"amountReceived",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"address",name:"pool",type:"address"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoter.QuoteExactInputSingleWithPoolParams",name:"params",type:"tuple"}],name:"quoteExactInputSingleWithPool",outputs:[{internalType:"uint256",name:"amountReceived",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"path",type:"bytes"},{internalType:"uint256",name:"amountOut",type:"uint256"}],name:"quoteExactOutput",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint160[]",name:"sqrtPriceX96AfterList",type:"uint160[]"},{internalType:"uint32[]",name:"initializedTicksCrossedList",type:"uint32[]"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoter.QuoteExactOutputSingleParams",name:"params",type:"tuple"}],name:"quoteExactOutputSingle",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"address",name:"tokenOut",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint24",name:"fee",type:"uint24"},{internalType:"address",name:"pool",type:"address"},{internalType:"uint160",name:"sqrtPriceLimitX96",type:"uint160"}],internalType:"struct IQuoter.QuoteExactOutputSingleWithPoolParams",name:"params",type:"tuple"}],name:"quoteExactOutputSingleWithPool",outputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint160",name:"sqrtPriceX96After",type:"uint160"},{internalType:"uint32",name:"initializedTicksCrossed",type:"uint32"},{internalType:"uint256",name:"gasEstimate",type:"uint256"}],stateMutability:"view",type:"function"}];var _=class{logLevel=1;prefix(){return "[HOLDSTATION-CORE]"}setLogLevel(e){this.logLevel=e;}debug(...e){this.logLevel>0||console.debug(this.prefix(),...e);}info(...e){this.logLevel>1||console.info(this.prefix(),...e);}warn(...e){this.logLevel>2||console.warn(this.prefix(),...e);}error(...e){this.logLevel>3||console.error(this.prefix(),...e);}log(...e){this.logLevel>4||console.log(this.prefix(),...e);}trace(...e){this.logLevel>5||console.trace(this.prefix(),...e);}},d=new _;var H=class{multicall3Address;_client;_multicall3;constructor(){this.multicall3Address="0xcA11bde05977b3631167028862bE2a173976CA11";}get client(){if(!this._client)throw new Error("Client is not set");return this._client}set client(e){d.debug("Set new client",e.name()),this._client=e;}get multicall3(){if(!this._multicall3)throw new Error("Multicall3 is not set");return this._multicall3}set multicall3(e){d.debug("Set new multicall3",e),this._multicall3=e;}},P=new H;var D=class{db;constructor(e="TokenDB"){this.db=idb.openDB(e,2,{upgrade(t){t.objectStoreNames.contains("tokens")||t.createObjectStore("tokens",{keyPath:"address"});}});}async save(e){await(await this.db).put("tokens",e);}async findByAddress(e){let n=await(await this.db).get("tokens",e);if(!n)throw new Error(`Token not found for address: ${e}`);return n}async find(e){let r=(await this.db).transaction("tokens").objectStore("tokens"),y=[];for(let s of e){let i=await r.get(s);i&&y.push(i);}return y}};var W=class{db;constructor(e="TransactionDB"){this.db=idb.openDB(e,2,{upgrade(t){t.objectStoreNames.contains("transactions")||t.createObjectStore("transactions",{keyPath:"hash"}).createIndex("block","block");}});}async save(e){await(await this.db).put("transactions",e);}async saveMultiple(e){let n=(await this.db).transaction("transactions","readwrite"),r=n.objectStore("transactions");for(let y of e)await r.put(y);await n.done;}async find(e,t){let r=(await this.db).transaction("transactions","readonly").objectStore("transactions").index("block"),y=[],s=await r.openCursor(null,"prev"),i=0;for(;s&&i<e;)s=await s.continue(),i++;for(;s&&y.length<t;)y.push(s.value),s=await s.continue();return y}async findByHash(e){let n=await(await this.db).get("transactions",e);if(!n)throw new Error(`Transaction not found for hash: ${e}`);return n}async findLastBlock(){let n=await(await this.db).transaction("transactions","readonly").objectStore("transactions").index("block").openCursor(null,"prev");return n?n.value.block:0}async findMinBlock(){let n=await(await this.db).transaction("transactions","readonly").objectStore("transactions").index("block").openCursor(null,"next");return n?n.value.block:0}};var $=(n=>(n[n.NotDefined=0]="NotDefined",n[n.Fail=1]="Fail",n[n.Success=2]="Success",n))($||{});var X=class{store={};async save(e){this.store[e.address]=e;}async findByAddress(e){let t=this.store[e];if(!t)throw new Error(`Token not found for address: ${e}`);return t}async find(e){return e.map(t=>this.store[t]).filter(t=>!!t)}},A=new X;var Q=class{saveMultiple(e){throw new Error("Method not implemented.")}save(e){throw new Error("Method not implemented.")}find(e,t){throw new Error("Method not implemented.")}findByHash(e){throw new Error("Method not implemented.")}findLastBlock(){throw new Error("Method not implemented.")}findMinBlock(){throw new Error("Method not implemented.")}},j=new Q;var Te="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",S=class{client;multicall3;storage;constructor(e){this.storage=e?.storage??A,this.multicall3=e?.multicall3??P.multicall3,this.client=e?.client??P.client;}async details(...e){let t={},n=await this.storage.find(e);for(let p of n)t[p.address]=p;let r=e.filter(p=>!t[p]);if(r.length===0)return t;let y=[];for(let p of r){if(!this.client.isValidAddress(p))throw new Error(`Invalid token address: ${p}`);y.push({target:p,callData:this.client.codec(g).encodeFunctionData("decimals")},{target:p,callData:this.client.codec(g).encodeFunctionData("symbol")},{target:p,callData:this.client.codec(g).encodeFunctionData("name")});}let s=await this.multicall3.aggregate(y),[i,u]=s;for(let p=0;p<u.length;p+=3){let a=r[p/3],l=u[p],m=u[p+1],c=u[p+2];t[a]={address:a,chainId:this.client.getChainId(),decimals:new k.BigNumber(l).toNumber(),symbol:this.client.codec(g).decodeFunctionResult("symbol",m).toString(),name:this.client.codec(g).decodeFunctionResult("name",c).toString()};}return await Promise.all(Object.keys(t).map(p=>this.storage.save(t[p]))),t}async tokenOf(e,t){let n=t?.blockPerRequest??1e4,r=await this.client.getBlockNumber(),y=t?.toBlock??r,s=t?.fromBlock??y-10*n,i=[];for(let a=s;a<=y;a+=n){let l=Math.min(a+n-1,y);i.push([a,l]);}let u=await Promise.all(i.map(async([a,l])=>(await this.client.getLogs({topics:[[Te],[],[e]],fromBlock:a,toBlock:l})).map(T=>T.address))),p=new Set;for(let a of u)for(let l of a)p.add(l);return Array.from(p)}async balanceOf(e){if("token"in e&&Array.isArray(e.wallets))return this.balanceOfTokenWallets(e);if("wallet"in e&&Array.isArray(e.tokens))return this.balanceOfWalletTokens(e);throw new Error("Invalid parameters for balanceOf")}async balanceOfWalletTokens({wallet:e,tokens:t}){let n=[];for(let i of t){if(!this.client.isValidAddress(i))throw new Error(`Invalid token address: ${i}`);n.push({target:i,callData:this.client.codec(g).encodeFunctionData("balanceOf",[e])});}let[r,y]=await this.multicall3.aggregate(n),s={};for(let i=0;i<y.length;i++){let u=t[i],p=y[i];s[u]=this.client.codec(g).decodeFunctionResult("balanceOf",p).toString();}return s}async balanceOfTokenWallets({token:e,wallets:t}){let n=[];for(let i of t){if(!this.client.isValidAddress(i))throw new Error(`Invalid wallet address: ${i}`);n.push({target:e,callData:this.client.codec(g).encodeFunctionData("balanceOf",[i])});}let[r,y]=await this.multicall3.aggregate(n),s={};for(let i=0;i<y.length;i++){let u=t[i],p=y[i];s[u]=this.client.codec(g).decodeFunctionResult("balanceOf",p).toString();}return s}};var U=class{listeners={};mutex=new asyncMutex.Mutex;client;tokenProvider;tokenStorage;transactionStorage;constructor(e){this.client=e?.client??P.client,this.tokenProvider=e?.tokenProvider??new S({client:this.client,multicall3:P.multicall3,storage:A}),this.tokenStorage=e?.storage?.token??A,this.transactionStorage=e?.storage?.tx??j;}watch=async(e,t,n)=>{let r=this.mutex,y=await r.acquire();try{if(this.listeners[e.toLowerCase()]){let s=this.listeners[e.toLowerCase()];s&&s.stop(),delete this.listeners[e.toLowerCase()];}return this.listeners[e.toLowerCase()]=new V(e,{client:this.client,tokenProvider:this.tokenProvider,storage:{token:this.tokenStorage,tx:this.transactionStorage}}),{start:async()=>{let s=await r.acquire();try{let i=this.listeners[e.toLowerCase()];d.debug(`Starting runner for ${e}...`),await i.run(t,n),d.debug(`Runner for ${e} successfully started`);}finally{s();}},stop:async()=>{let s=this.listeners[e.toLowerCase()];s&&s.stop(),delete this.listeners[e.toLowerCase()];}}}finally{y();}}},V=class{constructor(e,t){this.walletAddress=e;this.client=t.client,this.tokenStorage=t.storage.token,this.transactionStorage=t.storage.tx,this.tokenProvider=t.tokenProvider;}lastBlock=0;minBlock=0;blockstep=2e3;aborted=false;delay=1e3;client;tokenStorage;transactionStorage;tokenProvider;run=async(e,t)=>{this.lastBlock=await this.client.getBlockNumber();let n=await this.transactionStorage.findLastBlock(),r=Math.max(n,e);this.minBlock=r,d.debug("Block",{last:Math.min(t,this.lastBlock),min:this.minBlock}),await this.loop();};stop=async()=>{this.aborted=true;};async loop(){for(;!this.aborted;){if(this.lastBlock<this.minBlock){d.debug(`MinBlock ${this.minBlock} is too far from lastBlock ${this.lastBlock}`);return}await this.queryLogs(this.lastBlock-1e4,this.lastBlock).then(()=>{this.lastBlock=this.lastBlock-1e4;}),await new Promise(e=>{setTimeout(()=>e(null),this.delay);});}}getMethodId(e){return e.slice(0,10)}async retry(e,t){let n=0;for(;n<t;)try{return await e()}catch(r){if(n++,d.error(`Attempt ${n} failed:`,r),n>=t)throw d.error(`Failed after ${t} attempts.`),r}throw new Error("Retry logic failed unexpectedly.")}async queryLogs(e,t){let n=this.client.hexZeroPad(this.walletAddress,32).toLowerCase();for(let r=t;r>=e;r-=this.blockstep){if(this.aborted){d.debug("Aborted");break}let y=await this.retry(()=>Promise.all([this.client.getLogs({fromBlock:Math.max(r-this.blockstep,e),toBlock:r,topics:["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",[n]]}),this.client.getLogs({fromBlock:Math.max(r-this.blockstep,e),toBlock:r,topics:["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",null,[n]]})]),3),s={},i=[...y[0],...y[1]];for(let a of i){s[a.transactionHash]||(s[a.transactionHash]=[]);let l;try{l=await this.tokenStorage.findByAddress(a.address);}catch{l={...(await this.tokenProvider.details(a.address))[a.address],address:a.address,chainId:this.client.getChainId()},await this.tokenStorage.save(l);}s[a.transactionHash].push({tokenAddress:a.address,amount:new k.BigNumber(a.data).toString(),from:a.topics[1],to:a.topics[2]});}let u=await Promise.all(Array.from(Object.keys(s)).map(async a=>await this.client.getTransaction(a))),p=[];for(let a of u)!a||!a.hash||p.push({hash:a.hash,block:a.blockNumber??0,to:a.to??"",success:0,date:new Date((a.blockNumber??0)*1e3),method:this.getMethodId(a.data),protocol:"",transfers:s[a.hash].map(l=>({tokenAddress:l.tokenAddress,amount:l.amount,from:l.from,to:l.to}))});await this.transactionStorage.saveMultiple(u.map(a=>{if(!(!a||!a.hash))return {hash:a.hash,block:a.blockNumber??0,to:a.to??"",success:0,date:new Date((a.blockNumber??0)*1e3),method:this.getMethodId(a.data),protocol:"",transfers:s[a.hash].map(l=>({tokenAddress:l.tokenAddress,amount:l.amount,from:l.from,to:l.to}))}}).filter(a=>typeof a<"u"));}}};var Y=class{spender="0x43222f934ea5c593a060a6d46772fdbdc2e2cff0";tokenProvider;constructor(e){this.tokenProvider=e??new S;}async native({amount:e,to:t}){let n=`0x${new k__default.default(e).multipliedBy(1e18).toString(16)}`;return await minikitJs.MiniKit.commandsAsync.sendTransaction({transaction:[{address:this.spender,abi:q,functionName:"send",args:[t],value:n}]})}async erc20({amount:e,token:t,to:n}){let y=(await this.tokenProvider.details(t))[t].decimals,s=new k__default.default(e).multipliedBy(10**y).toFixed(),i=Math.floor((Date.now()+30*60*1e3)/1e3).toString(),u={permitted:{token:t,amount:s},nonce:Date.now().toString(),deadline:i},p=[[u.permitted.token,u.permitted.amount],u.nonce,u.deadline],a={spender:this.spender,requestedAmount:s},l=[a.spender,a.requestedAmount],m={transaction:[{address:this.spender,abi:q,functionName:"transfer",args:[p,l,n,"PERMIT2_SIGNATURE_PLACEHOLDER_0"]}],permit2:[{...u,spender:this.spender}]};return await minikitJs.MiniKit.commandsAsync.sendTransaction(m)}async send(e){return "token"in e?this.erc20(e):this.native(e)}};function ee(o,e){return e.find(t=>t.toLowerCase()===o.toLowerCase())!==void 0}function b(o){return o==="0x0000000000000000000000000000000000000000"||o.toLowerCase()==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"}function x(o,e,t,n){return b(o)||b(e)||ee(o,t)?0:ee(e,t)||n&&e.toLowerCase()===n.toLowerCase()?1:0}function M(o,e,t){return b(o)?{feePercent:`0x${new k__default.default(t/100).multipliedBy(Math.pow(10,18)).toString(16)}`}:{feeAmount:`0x${e.multipliedBy(t/100).integerValue(k__default.default.ROUND_FLOOR).toString(16)}`,feeToken:0}}function L(o,e){return {feeAmount:`0x${new k__default.default(o).multipliedBy(e/100).integerValue(k__default.default.ROUND_FLOOR).toString(16)}`,feeToken:1}}var C={tokens:{weth:{address:"0x4200000000000000000000000000000000000006",symbol:"WETH",decimals:18,name:"Wrapped Ether",chainId:480},wld:{address:"0x2cFc85d8E48F8EAB294be644d9E25C3030863003",symbol:"WLD",decimals:18,name:"Worldcoin",chainId:480},eth:{address:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",symbol:"ETH",decimals:18,name:"Ether",chainId:480}},uniswap:{router:{v2:"0x541aB7c31A119441eF3575F6973277DE0eF460bd",v3:"0x091AD9e2e6e5eD44c1c66dB50e49A601F9f36cF6"},quoter:{v2:"0x10158D43e6cc414deE1Bd1eB0EfC6a5cBCfF244c"}},spender:"0x43222f934ea5c593a060a6d46772fdbdc2e2cff0",stableCoins:["0x79A02482A880bCE3F13e09Da970dC34db4CD24d1"],tradeSurplusRecipient:"0x8d61d7fe817efc69a2169f0d5f39b41ed5c89409"};var ge="0x0281c83C8F53314DFF3ebE24A90ee2412A2aA970",te=class{constructor(e,t,n){this.tokenProvider=e;this.tokenStorage=t;this.config=Object.assign(this.config,n??{});}config=C;name(){return "hold-so"}enabled(e){return e===480}async holdSoSwapRequest(e){let t="https://api.worldswap.org/worldchain/api/swap",n=new URLSearchParams;Object.entries(e).forEach(([s,i])=>{i!=null&&n.append(s,i.toString());});let r=await fetch(`${t}?${n.toString()}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(r.status<200||r.status>=400)throw new Error(`${r.status}`);return await r.json()}async estimate(e){let{tokenIn:t,tokenOut:n,fee:r="0.2",slippage:y="3"}=e,s=new k__default.default(e.amountIn),i=await this.findToken(t),u=await this.findToken(n),p=new k__default.default(s).multipliedBy(10**i.decimals||18),a=parseFloat(r);if(isNaN(a))throw new Error(`Invalid fee value: ${r}`);x(i.address,u.address,this.config.stableCoins,this.config.tokens.wld.address)===0&&(p=p.minus(M(u.address,p,a)?.feeAmount??0));let l=parseFloat(y);if(isNaN(l)||l<0||l>100)throw new Error("Invalid slippage value. It must be between 0 and 100.");let m=await this.holdSoSwapRequest({src:i.address,dst:u.address,amount:new k__default.default(p).toFixed(0),receiver:this.config.spender,slippage:l/100}),c=new k__default.default(m.quote.toAmount),T=new k__default.default(0);x(i.address,u.address,this.config.stableCoins,this.config.tokens.wld.address)===1&&(T=new k__default.default(L(`0x${c.toString(16)}`,a)?.feeAmount??"0"));let f=c.multipliedBy(new k__default.default(1).minus(Number(l)/1e4)).integerValue(k__default.default.ROUND_DOWN).minus(T),h=s.dividedBy(c).multipliedBy(10**u.decimals),w=f.div(Math.pow(10,u.decimals)),E=new k__default.default(m.quote.toAmountUsd);return {data:m.tx.data??"",value:b(i.address)?p.toFixed():"0",to:ge,addons:{outAmount:c.div(10**u.decimals).toString(),rateSwap:h.toString(),amountOutUsd:E.toString(),minReceived:w.toString(),feeAmountOut:`0x${T.toString(16)}`}}}async findToken(e){let t;if(b(e))return this.config.tokens.eth;try{t=await this.tokenStorage.findByAddress(e);}catch{t={...(await this.tokenProvider.details(e))[e],address:e},await this.tokenStorage.save(t);}return t}};var R=null,z="code.pnrtnr",G=()=>{try{let e=new Function('return typeof localStorage !== "undefined" ? localStorage : null')();if(e&&typeof e.getItem=="function"&&typeof e.setItem=="function"&&typeof e.removeItem=="function")return e}catch(o){d.debug("Storage is not accessible:",o);}return null},Qt=o=>{if(!o||typeof o!="string")return d.error("Invalid partner code:",o),false;R=o,d.debug("Partner code set:",o);try{let e=G();e&&(e.setItem(z,o),d.debug("Partner code also saved to persistent storage"));}catch(e){d.debug("Could not save to persistent storage:",e);}return  true},F=()=>{if(R)return R;try{let o=G();if(o){let e=o.getItem(z);if(e)return R=e,d.debug("Partner code retrieved from persistent storage:",e),e}}catch(o){d.debug("Could not read from persistent storage:",o);}return null},jt=()=>{R=null;try{let o=G();o&&(o.removeItem(z),d.debug("Partner code removed from persistent storage"));}catch(o){d.debug("Could not remove from persistent storage:",o);}return  true},ne=null,ke=()=>{if(!ne)try{let o=new Function('return typeof setInterval === "function" ? setInterval : null')();o&&(ne=o(()=>{F()||d.warn("\u26A0\uFE0F Partner code is not set. Please call setPartnerCode()");},5e3),d.debug("Partner code check initialized"));}catch(o){d.debug("Could not initialize partner code check:",o);}};ke();var ae=class{constructor(e,t){this.client=e;this.estimate={quote:this._quote.bind(this)},this.tokenProvider=new S({client:e}),this.tokenStorage=t?.tokenStorage??new D("TokenDB"),this.config=Object.assign(this.config,t??{});}modules={};tokenProvider;tokenStorage;estimate;config=C;async load(e){this.modules[e.name()]=e;}async _quote(e){let{timeout:t=3e4,preferRouters:n=["hold-so","0x"]}=e,r=this.client.getChainId(),y=n;if(y.length===0)throw new Error("No router available");let s=y.map(a=>this.modules[a]).filter(a=>a&&a.enabled(r));if(s.length===0)throw new Error("No valid router available");let i=Date.now(),u=[];for(let a of s){if(Date.now()-i>=t)throw new Error(`Timeout after ${t}ms`);try{let m=await a.estimate(e);if(m)return m}catch(m){d.error(`Error estimating swap for router ${a.name()}:`,m),u.push({router:a.name(),error:m});}}let p=u.map(a=>`${a.router}: ${a.error instanceof Error?a.error.message:a.error}`).join("; ");throw new Error(`All routers failed. Errors: ${p}`)}async swap(e){return b(e.tokenIn)?await this.submitSwapETHForTokens(e):b(e.tokenOut)?await this.submitSwapTokensForETH(e):await this.submitSwapTokensForTokens(e)}async submitSwapTokensForTokens(e){let{tokenIn:t,tokenOut:n,amountIn:r,fee:y="0.2",feeReceiver:s="0x0000000000000000000000000000000000000000",feeAmountOut:i,partnerCode:u}=e,{data:p,to:a}=e.tx,l=await this.findToken(t),m=new k.BigNumber(r).multipliedBy(Math.pow(10,l.decimals)).toFixed(),c=Math.floor((Date.now()+5*60*1e3)/1e3).toString(),T={permitted:{token:t,amount:m},nonce:Date.now().toString(),deadline:c},f="0",h="0";x(t,n,this.config.stableCoins,this.config.tokens.wld.address)===0?(h=M(n,new k.BigNumber(m),Number(y))?.feeAmount??"0",f="0"):(h=i??"0",f="1");let w=this.packPartnerData(u??F()??"0",h),E={transaction:[{address:this.config.spender,abi:B.DEX_ABI,functionName:"fillQuoteTokenToToken",args:[t,n,a,p,m,f,w,s,[T.nonce,T.deadline,"PERMIT2_SIGNATURE_PLACEHOLDER_0"]],value:"0x0"}],permit2:[{...T,spender:this.config.spender}]};d.log("fillQuoteTokenToToken: ",E);let O=await minikitJs.MiniKit.commandsAsync.sendTransaction(E);return O.finalPayload.status!=="success"?{success:false,errorCode:O.finalPayload.error_code}:{success:true,transactionId:O.finalPayload.transaction_id}}async submitSwapETHForTokens(e){let{tokenIn:t,tokenOut:n,amountIn:r,fee:y="0.2",feeReceiver:s="0x0000000000000000000000000000000000000000",partnerCode:i}=e,{data:u,to:p}=e.tx,a=await this.findToken(t),l=`0x${new k.BigNumber(r).multipliedBy(Math.pow(10,a.decimals)).toString(16)}`,m=M(n,new k.BigNumber(l),Number(y))?.feeAmount??"0",c=this.packPartnerData(i??F()??"0",m),T={transaction:[{address:this.config.spender,abi:B.DEX_ABI,functionName:"fillQuoteEthToToken",args:[n,p,u,c,s],value:l}]};d.log("fillQuoteEthToToken: ",T);let f=await minikitJs.MiniKit.commandsAsync.sendTransaction(T);return f.finalPayload.status!=="success"?{success:false,errorCode:f.finalPayload.error_code}:{success:true,transactionId:f.finalPayload.transaction_id}}async submitSwapTokensForETH(e){let{tokenIn:t,tokenOut:n,amountIn:r,fee:y="0.2",feeReceiver:s="0x0000000000000000000000000000000000000000",partnerCode:i}=e,{data:u,to:p}=e.tx,a=await this.findToken(t),l=new k.BigNumber(r).multipliedBy(Math.pow(10,a.decimals)).toFixed(),m=Math.floor((Date.now()+5*60*1e3)/1e3).toString(),c=M(n,new k.BigNumber(l),Number(y))?.feePercent??"0",T={permitted:{token:t,amount:l},nonce:Date.now().toString(),deadline:m},f=this.packPartnerData(i??F()??"0",c),h={transaction:[{address:this.config.spender,abi:B.DEX_ABI,functionName:"fillQuoteTokenToEth",args:[t,p,u,l,f,s,[T.nonce,T.deadline,"PERMIT2_SIGNATURE_PLACEHOLDER_0"]],value:"0x0"}],permit2:[{...T,spender:this.config.spender}]};d.log("fillQuoteTokenToEth: ",h);let w=await minikitJs.MiniKit.commandsAsync.sendTransaction(h);return w.finalPayload.status!=="success"?{success:false,errorCode:w.finalPayload.error_code}:{success:true,transactionId:w.finalPayload.transaction_id}}async findToken(e){let t;if(b(e))return this.config.tokens.eth;try{t=await this.tokenStorage.findByAddress(e);}catch{t={...(await this.tokenProvider.details(e))[e],address:e},await this.tokenStorage.save(t);}return t}packPartnerData(e,t){let n=BigInt(e),r=BigInt(t),s=n<<240n|r;return new k.BigNumber(s).toFixed()}};var ie=class{constructor(e,t,n){this.tokenProvider=e;this.tokenStorage=t;this.config=Object.assign(this.config,n??{});}config=C;name(){return "0x"}enabled(e){return e===480}async zeroXRequest(e){let t="https://bridge.holdstation.com/0x/swap/allowance-holder/quote",n=new URLSearchParams;Object.entries(e).forEach(([s,i])=>{i!=null&&n.append(s,i.toString());});let r=await fetch(`${t}?${n.toString()}`,{method:"GET",headers:{"X-Bridge-Purpose":"worldchain-app","Content-Type":"application/json"}});if(r.status<200||r.status>=400)throw new Error(`${r.status}`);return await r.json()}async tokenRateUsd(e){if(e.address===this.config.stableCoins[0])return 1;let t=await this.zeroXRequest({chainId:480,sellToken:e.address,buyToken:this.config.stableCoins[0],sellAmount:new k__default.default(1).multipliedBy(10**e.decimals).toFixed(0),taker:this.config.spender,slippageBps:0});return new k__default.default(t.buyAmount).dividedBy(10**6).toNumber()}async estimate(e){let{tokenIn:t,tokenOut:n,fee:r="0.2",slippage:y="3"}=e,s=new k__default.default(e.amountIn),i=await this.findToken(t),u=await this.findToken(n),p=new k__default.default(s).multipliedBy(10**i.decimals||18),a=parseFloat(r);if(isNaN(a))throw new Error(`Invalid fee value: ${r}`);x(i.address,u.address,this.config.stableCoins,this.config.tokens.wld.address)===0&&(p=p.minus(M(u.address,p,a)?.feeAmount??0));let l=parseFloat(y);if(isNaN(l)||l<0||l>100)throw new Error("Invalid slippage value. It must be between 0 and 100.");let m=await this.zeroXRequest({chainId:480,sellToken:i.address,buyToken:u.address,sellAmount:new k__default.default(p).toFixed(0),taker:this.config.spender,slippageBps:l*100,tradeSurplusRecipient:this.config.tradeSurplusRecipient}),c=new k__default.default(m.buyAmount),T=new k__default.default(0);x(i.address,u.address,this.config.stableCoins,this.config.tokens.wld.address)===1&&(T=new k__default.default(L(`0x${c.toString(16)}`,a)?.feeAmount??"0"));let f=c.multipliedBy(new k__default.default(1).minus(Number(l)/1e4)).integerValue(k__default.default.ROUND_DOWN).minus(T),h=s.dividedBy(c).multipliedBy(10**u.decimals),w=await this.tokenRateUsd(u),E=f.div(Math.pow(10,u.decimals)),O=new k__default.default(c).div(10**u.decimals).multipliedBy(w);return {data:m.transaction.data??"",value:b(i.address)?p.toFixed():"0",to:m.transaction.to??"",addons:{outAmount:c.div(10**u.decimals).toString(),rateSwap:h.toString(),amountOutUsd:O.toString(),minReceived:E.toString(),feeAmountOut:`0x${T.toString(16)}`}}}async findToken(e){let t;if(b(e))return this.config.tokens.eth;try{t=await this.tokenStorage.findByAddress(e);}catch{t={...(await this.tokenProvider.details(e))[e],address:e},await this.tokenStorage.save(t);}return t}};
exports.DEX_ABI=q;exports.ERC20_ABI=g;exports.HoldSo=te;exports.IdbTokenStorage=D;exports.IndexedDBTransactionStorageImpl=W;exports.MULTICALL3_JSONABI=oe;exports.Manager=U;exports.Sender=Y;exports.SwapHelper=ae;exports.TokenProvider=S;exports.TransactionStatus=$;exports.ZeroX=ie;exports.abi=B;exports.clearPartnerCode=jt;exports.config=P;exports.defaultWorldchainConfig=C;exports.getFeeDirect=x;exports.getFeeWithAmountIn=M;exports.getFeeWithAmountOut=L;exports.getPartnerCode=F;exports.initPartnerCodeCheck=ke;exports.inmemoryTokenStorage=A;exports.inmemoryTransactionStorage=j;exports.isNativeToken=b;exports.isStableCoin=ee;exports.logger=d;exports.setPartnerCode=Qt;exports.uniswapQuoterV2ABI=pe;exports.uniswapRouterV2ABI=ue;exports.uniswapRouterV3ABI=le;exports.viewQuoterv3ABI=ye;//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map